version: '3.8'

services:
    meetup:
        image: jitsi/web:stable
        restart: unless-stopped
        volumes:
            - ./config/web:/config
        environment:
            - ENABLE_LETSENCRYPT=1
            - DISABLE_HTTPS=0
            - PUBLIC_URL=https://meet.meetup.mathe-server
        networks:
            - meet.jitsi
            - coolify
        labels:
            - "traefik.enable=true"
            - "traefik.http.routers.meetup.rule=Host(`meet.meetup.mathe-server`)"
            - "traefik.http.routers.meetup.entrypoints=websecure"
            - "traefik.http.services.meetup.loadbalancer.server.port=80"
        depends_on:
            - prosody
            - jicofo
            - jvb

    prosody:
        image: jitsi/prosody:stable
        restart: unless-stopped
        volumes:
            - ./config/prosody:/config
        environment:
            - AUTH_TYPE=internal
            - JICOFO_AUTH_USER=focus
            - JICOFO_AUTH_PASSWORD=supersecret
            - JVB_AUTH_USER=jvb
            - JVB_AUTH_PASSWORD=anothersecret
        networks:
            - meet.jitsi

    jicofo:
        image: jitsi/jicofo:stable
        restart: unless-stopped
        volumes:
            - ./config/jicofo:/config
        environment:
            - JICOFO_AUTH_USER=focus
            - JICOFO_AUTH_PASSWORD=supersecret
            - XMPP_DOMAIN=meet.jitsi
            - XMPP_AUTH_DOMAIN=auth.meet.jitsi
            - XMPP_SERVER=prosody
        networks:
            - meet.jitsi
        depends_on:
            - prosody

    jvb:
        image: jitsi/jvb:stable
        restart: unless-stopped
        volumes:
            - ./config/jvb:/config
        ports:
            - "31000:10000/udp"
        environment:
            - JVB_AUTH_USER=jvb
            - JVB_AUTH_PASSWORD=anothersecret
            - XMPP_AUTH_DOMAIN=auth.meet.jitsi
            - XMPP_SERVER=prosody
            - JVB_PORT=10000
            - JVB_PORT_MAPPING=31000
            - JVB_ADVERTISE_IPS=your.public.ip.here
        networks:
            - meet.jitsi
        depends_on:
            - prosody


networks:
    meet.jitsi:
    coolify:
        external: true
